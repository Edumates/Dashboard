(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{518:function(e,t,n){"use strict";n.r(t);n(13),n(12),n(15),n(11),n(16),n(59),n(65),n(72),n(84);var r=n(516),o=n(85),l=n(143),c=(n(217),n(60),n(4),n(53),n(64),n(501),n(299),n(42),n(99),n(26),n(71),n(14),n(533),n(534),n(67),n(83),n(510));function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw o}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function f(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var h={name:"Settings",props:["pendingEdits"],data:function(){var e=this;return{tab:0,saveLoading:!1,saveSuccess:!1,memberTeacher:"",memberStudent:"",className:"",saveError:!1,modules:[],pageLoading:!0,stationUrl:"",memberUrl:"",moduleImportUrl:"",moduleImportUrlRules:[function(t){return e.validate_url(t)||"Please enter a valid module URL"}],scrapedModules:[],selectedFile:void 0,restoreFileRules:[function(e){return!e||e.size<2e6||"File should be less than 2 MB!"}],restoreSuccess:!1}},computed:{newClass:function(){return f(f({},this.$store.state.class_),{},{name:this.className,members:{teacher:this.strToList(this.memberTeacher),student:this.strToList(this.memberStudent)},modules:this.modules.map((function(e){return f(f({},e),{},{config:e.config,studentConfig:e.studentConfig,teacherConfig:e.teacherConfig,stationConfig:e.stationConfig})}))})}},watch:{"$store.state.class_":function(){this.updateState()},newClass:function(){JSON.stringify(this.newClass)!==JSON.stringify(this.$store.state.class_)&&this.$emit("update:pendingEdits",!0)},modules:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r,o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],r=v(e.modules),t.prev=2,r.s();case 4:if((o=r.n()).done){t.next=13;break}return l=o.value,t.t0=n,t.next=9,e.scrapeModule(l);case 9:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 11:t.next=4;break;case 13:t.next=18;break;case 15:t.prev=15,t.t2=t.catch(2),r.e(t.t2);case 18:return t.prev=18,r.f(),t.finish(18);case 21:e.scrapedModules=n;case 22:case"end":return t.stop()}}),t,null,[[2,15,18,21]])})))()}},mounted:function(){this.updateState()},methods:{downloadClass:function(){this.download("class-".concat(this.$store.state.class_.id,".json"),JSON.stringify(this.$store.state.class_))},restoreFile:function(e){var t=this;this.restoreSuccess=!1,this.saveError=!1;var n=new FileReader;n.readAsText(this.selectedFile),n.onload=function(e){t.updateState(JSON.parse(e.target.result)),t.restoreSuccess=!0},n.onerror=function(e){t.restoreSuccess=!1,t.saveError=!0}},validate_url:function(e){try{return new URL(e),!0}catch(e){return!1}},updateState:function(){var e,t,n,o,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;l=l||this.$store.state.class_,this.className=l.name,this.memberTeacher=(null===(e=l.members)||void 0===e?void 0:e.teacher.join("\n"))||"",this.memberStudent=(null===(t=l.members)||void 0===t||null===(n=t.student)||void 0===n?void 0:n.join("\n"))||"",this.modules=Object(r.a)(null===(o=l)||void 0===o?void 0:o.modules.map((function(e){return f(f({},e),{},{config:e.config,studentConfig:e.studentConfig,teacherConfig:e.teacherConfig,stationConfig:e.stationConfig})})))||[],this.memberUrl=window.location.href.replace("#station","").replace("http://","").replace("https://",""),this.stationUrl=window.location.href.replace("#settings","").replace("#station","").replace("http://","").replace("https://","")+"#station"},copyStationUrl:function(){navigator.clipboard.writeText(this.stationUrl)},copyMemberUrl:function(){navigator.clipboard.writeText(this.memberUrl)},deleteClass:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.$store.state.class_.id,t.prev=1,t.next=4,e.$axios.$get("/data/deleteClass/".concat(n));case 4:t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(1),console.log("Error deleting class..."),t.abrupt("return");case 10:return t.next=12,e.$axios.$get("/data/readUser");case 12:return r=t.sent,t.t1=e.$store,t.next=16,e.$axios.$get("/data/updateUser?user=".concat(encodeURIComponent(JSON.stringify(f(f({},r),{},{memberships:r.memberships.filter((function(e){return e.class_id!=n}))})))));case 16:t.t2=t.sent,t.t1.commit.call(t.t1,"setUser",t.t2),e.$router.push({path:"/"});case 19:case"end":return t.stop()}}),t,null,[[1,6]])})))()},strToList:function(e){return e.replace(/ /g,"").split(",").flatMap((function(s){return s.trim().split("\n")})).filter((function(e){return/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(e)}))},importModule:function(){this.modules.push({url:this.moduleImportUrl,config:"",studentConfig:"",teacherConfig:"",stationConfig:"",width:"full",height:"tall"}),this.moduleImportUrl=""},save:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.saveError=!1,e.saveSuccess=!1,e.saveLoading=!0,t.prev=3,t.t0=e.$store,t.next=7,e.$axios.$get("/data/updateClass/".concat(e.$store.state.class_.id)+"?class=".concat(encodeURIComponent(JSON.stringify(e.newClass))));case 7:t.t1=t.sent,t.t0.commit.call(t.t0,"setClass",t.t1),e.saveLoading=!1,e.saveSuccess=!0,e.$emit("update:pendingEdits",!1),e.$emit("close"),t.next=20;break;case 15:t.prev=15,t.t2=t.catch(3),console.log(t.t2),e.saveError=!0,e.saveLoading=!1;case 20:e.$router.app.refresh();case 21:case"end":return t.stop()}}),t,null,[[3,15]])})))()}},components:{draggable:n.n(c).a}},_=h,x=n(107),y=n(142),k=n.n(y),S=n(603),w=n(604),C=n(227),V=n(208),U=n(97),$=n(601),O=n(561),T=n(605),L=n(606),j=n(607),I=n(608),E=n(615),M=n(490),R=n(204),F=n(536),N=n(514),A=n(537),P=n(542),D=n(496),J=n(616),B=n(602),G=n(609),H=n(493),z=n(494),Y=n(610),K=n(617),Q=n(614),W=n(597),X=n(222),Z=n(611),ee=n(58),te=n(220),component=Object(x.a)(_,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-card",[n("v-toolbar",{attrs:{dark:"",flat:""},scopedSlots:e._u([{key:"extension",fn:function(){return[n("v-tabs",{attrs:{"fixed-tabs":"","center-active":"","show-arrows":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[n("v-tab",{attrs:{active:""}},[n("v-icon",{attrs:{left:""}},[e._v(" mdi-book-open-outline ")]),e._v("\n          Settings\n        ")],1),e._v(" "),n("v-tab",[n("v-icon",{attrs:{left:""}},[e._v(" mdi-account-group ")]),e._v("\n          Members\n        ")],1),e._v(" "),n("v-tab",[n("v-icon",{attrs:{left:""}},[e._v(" mdi-view-dashboard ")]),e._v("\n          Modules\n        ")],1),e._v(" "),n("v-tab",[n("v-icon",{attrs:{left:""}},[e._v(" mdi-router-wireless ")]),e._v("\n          Stations\n        ")],1),e._v(" "),n("v-tab",[n("v-icon",{attrs:{left:""}},[e._v(" mdi-share-variant ")]),e._v("\n          Share\n        ")],1)],1)]},proxy:!0}])},[n("v-toolbar-title",[e._v("Class Settings")]),e._v(" "),n("v-spacer"),e._v(" "),n("v-btn",{attrs:{icon:""},on:{click:function(t){return e.$emit("close")}}},[n("v-icon",[e._v("mdi-close")])],1)],1),e._v(" "),n("v-card-text",{staticStyle:{height:"565px"}},[n("v-tabs-items",{staticClass:"pt-5",model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[n("v-tab-item",[n("v-form",{ref:"form",on:{submit:function(t){return t.preventDefault(),e.save.apply(null,arguments)}}},[n("v-text-field",{attrs:{counter:20,label:"Class Name",outlined:"",required:""},model:{value:e.className,callback:function(t){e.className=t},expression:"className"}})],1)],1),e._v(" "),n("v-tab-item",[n("v-alert",{attrs:{outlined:"",dense:"",type:"info"}},[e._v("\n          Enter emails below, one per line or separated by commas. Next,\n          invite your users in by sharing this link:\n          "),n("br"),e._v(" "),n("br"),e._v(" "),n("blockquote",{staticStyle:{"margin-left":"10px"}},[n("a",{attrs:{href:"//"+e.memberUrl}},[e._v(e._s(e.memberUrl))]),e._v(" "),n("v-btn",{attrs:{icon:"",small:""},on:{click:e.copyMemberUrl}},[n("v-icon",{attrs:{small:""}},[e._v("mdi-content-copy")])],1)],1)]),e._v(" "),n("v-textarea",{attrs:{outlined:"",label:"List of teacher emails"},model:{value:e.memberTeacher,callback:function(t){e.memberTeacher=t},expression:"memberTeacher"}}),e._v(" "),n("v-textarea",{attrs:{outlined:"",label:"List of student emails"},model:{value:e.memberStudent,callback:function(t){e.memberStudent=t},expression:"memberStudent"}})],1),e._v(" "),n("v-tab-item",[n("v-form",{on:{submit:function(t){return t.preventDefault(),e.importModule.apply(null,arguments)}}},[e.scrapedModules.length==e.modules.length?n("v-list",{attrs:{"two-line":""}},[n("draggable",{attrs:{handle:".handle"},model:{value:e.modules,callback:function(t){e.modules=t},expression:"modules"}},e._l(e.modules,(function(t,i){return n("v-list-item",{key:i,staticClass:"handle"},[n("v-list-item-avatar",[n("v-icon",{staticClass:"grey darken-3",attrs:{dark:""}},[e._v(e._s(e.scrapedModules[i].icon||"mdi-package")+"\n                  ")])],1),e._v(" "),n("v-list-item-content",[n("v-list-item-title",[e._v(e._s(e.scrapedModules[i].name))]),e._v(" "),n("v-list-item-subtitle",[e._v("\n                    "+e._s(e.scrapedModules[i].description)+"\n                  ")])],1),e._v(" "),n("v-list-item-action",[n("v-menu",{attrs:{"close-on-content-click":!1,"nudge-width":200,"offset-x":"","offset-y":"",transition:"slide-y-transition",bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,o=t.attrs;return[n("v-btn",e._g(e._b({attrs:{icon:""}},"v-btn",o,!1),r),[n("v-icon",{attrs:{color:"grey darken-1"}},[e._v("mdi-cog")])],1)]}}],null,!0)},[e._v(" "),n("v-expansion-panels",{staticStyle:{width:"100%"},attrs:{accordion:""}},[n("v-expansion-panel",[n("v-expansion-panel-header",{attrs:{"disable-icon-rotate":""},scopedSlots:e._u([{key:"actions",fn:function(){return[n("v-icon",[e._v(" mdi-link ")])]},proxy:!0}],null,!0)},[e._v("\n                          URL\n                          ")]),e._v(" "),n("v-expansion-panel-content",[n("v-text-field",{attrs:{filled:"",label:"Module URL"},model:{value:t.url,callback:function(n){e.$set(t,"url",n)},expression:"m.url"}})],1)],1),e._v(" "),n("v-expansion-panel",[n("v-expansion-panel-header",{scopedSlots:e._u([{key:"actions",fn:function(){return[n("v-icon",[e._v(" mdi-script-text ")])]},proxy:!0}],null,!0)},[e._v("\n                          General settings\n                          ")]),e._v(" "),n("v-expansion-panel-content",[n("v-textarea",{attrs:{filled:"","prepend-inner-icon":"mdi-script-text",label:"General settings"},model:{value:t.config,callback:function(n){e.$set(t,"config",n)},expression:"m.config"}})],1)],1),e._v(" "),n("v-expansion-panel",[n("v-expansion-panel-header",{scopedSlots:e._u([{key:"actions",fn:function(){return[n("v-icon",[e._v(" mdi-account-circle-outline ")])]},proxy:!0}],null,!0)},[e._v("\n                          Student Settings\n                          ")]),e._v(" "),n("v-expansion-panel-content",[n("v-textarea",{attrs:{filled:"","prepend-inner-icon":"mdi-account-circle-outline",label:"Student-only settings"},model:{value:t.studentConfig,callback:function(n){e.$set(t,"studentConfig",n)},expression:"m.studentConfig"}})],1)],1),e._v(" "),n("v-expansion-panel",[n("v-expansion-panel-header",{scopedSlots:e._u([{key:"actions",fn:function(){return[n("v-icon",[e._v(" mdi-clipboard-account-outline ")])]},proxy:!0}],null,!0)},[e._v("\n                          Teacher Settings\n                          ")]),e._v(" "),n("v-expansion-panel-content",[n("v-textarea",{attrs:{filled:"","prepend-inner-icon":"mdi-clipboard-account-outline",label:"Teacher-only settings"},model:{value:t.teacherConfig,callback:function(n){e.$set(t,"teacherConfig",n)},expression:"m.teacherConfig"}})],1)],1),e._v(" "),n("v-expansion-panel",[n("v-expansion-panel-header",{scopedSlots:e._u([{key:"actions",fn:function(){return[n("v-icon",[e._v(" mdi-router-wireless ")])]},proxy:!0}],null,!0)},[e._v("\n                          Station Settings\n                          ")]),e._v(" "),n("v-expansion-panel-content",[n("v-textarea",{attrs:{filled:"","prepend-inner-icon":"mdi-router-wireless",label:"Station-only settings"},model:{value:t.stationConfig,callback:function(n){e.$set(t,"stationConfig",n)},expression:"m.stationConfig"}})],1)],1)],1)],1)],1),e._v(" "),n("v-list-item-action",[n("v-btn",{attrs:{icon:""},on:{click:function(){e.modules.splice(i,1)}}},[n("v-icon",{attrs:{color:"grey darken-1"}},[e._v("mdi-close")])],1)],1)],1)})),1)],1):n("div",[n("v-skeleton-loader",{staticClass:"mx-auto",attrs:{type:"list-item-avatar-two-line"}})],1),e._v(" "),n("v-list-item",[n("v-list-item-avatar",[n("v-icon",{staticClass:"grey darken-3",attrs:{dark:""}},[e._v(" mdi-link ")])],1),e._v(" "),n("v-list-item-content",[n("v-text-field",{attrs:{label:"Module URL",required:""},model:{value:e.moduleImportUrl,callback:function(t){e.moduleImportUrl=t},expression:"moduleImportUrl"}})],1),e._v(" "),n("v-list-item-action",[n("v-btn",{attrs:{depressed:"",type:"submit",disabled:!e.validate_url(e.moduleImportUrl)}},[n("v-icon",{attrs:{left:""}},[e._v(" mdi-view-grid-plus ")]),e._v("\n                Add\n              ")],1)],1)],1)],1),e._v(" "),n("v-divider",{staticClass:"pb-2"}),e._v(" "),n("v-btn",{attrs:{href:"https://github.com/topics/edrys-module",target:"_blank"}},[n("v-icon",{attrs:{left:""}},[e._v(" mdi-github ")]),e._v("\n          Explore on GitHub\n        ")],1)],1),e._v(" "),n("v-tab-item",[e._v("\n        To add a new station, simply open this link on the client device:\n        "),n("br"),e._v(" "),n("br"),e._v(" "),n("blockquote",{staticStyle:{"margin-left":"15px"}},[n("a",{attrs:{href:"//"+e.stationUrl,target:"_blank"}},[e._v(e._s(e.stationUrl))]),e._v(" "),n("v-btn",{attrs:{icon:"",small:""},on:{click:e.copyStationUrl}},[n("v-icon",{attrs:{small:""}},[e._v("mdi-content-copy")])],1)],1),e._v(" "),n("br")]),e._v(" "),n("v-tab-item",[n("v-row",[n("v-col",[n("v-btn",{attrs:{depressed:"",block:""},on:{click:e.downloadClass}},[n("v-icon",{attrs:{left:""}},[e._v(" mdi-download ")]),e._v("\n              Download class file\n            ")],1)],1),e._v(" "),n("v-col",[n("v-file-input",{attrs:{dense:"",rules:e.restoreFileRules,accept:"application/json",label:"Restore class from file","prepend-icon":"mdi-upload"},on:{change:e.restoreFile},model:{value:e.selectedFile,callback:function(t){e.selectedFile=t},expression:"selectedFile"}})],1)],1)],1)],1)],1),e._v(" "),n("v-snackbar",{attrs:{timeout:2e3,value:e.restoreSuccess,absolute:"",bottom:"",right:"",color:"success"}},[e._v("\n    File restored - check everything is okay then save\n  ")]),e._v(" "),n("v-snackbar",{attrs:{timeout:600,value:e.saveSuccess,absolute:"",bottom:"",right:""}},[e._v("\n    Class saved successfully\n  ")]),e._v(" "),n("v-snackbar",{attrs:{timeout:1400,value:e.saveError,color:"error",absolute:"",bottom:"",right:""}},[e._v("\n    Sorry there was a problem saving, please try again\n  ")]),e._v(" "),n("v-card-actions",[n("div",{staticClass:"pr-4 float-right"},[n("v-badge",{staticStyle:{"margin-top":"30px"},attrs:{overlap:"",dot:"",color:"red",value:e.pendingEdits}},[n("v-btn",{attrs:{color:"primary",loading:e.saveLoading,disabled:e.saveLoading},on:{click:e.save}},[n("v-icon",{attrs:{left:""}},[e._v(" mdi-upload ")]),e._v("\n          Save")],1)],1)],1),e._v(" "),n("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on,o=t.attrs;return[n("v-btn",e._g(e._b({staticClass:"float-right",staticStyle:{"margin-top":"30px","margin-right":"10px"},attrs:{color:"",depressed:""}},"v-btn",o,!1),r),[e._v("\n          Delete Class")])]}}])},[e._v(" "),n("v-list",[n("v-list-item",[n("v-list-item-content",[e._v("Are you sure?\n\n            "),n("v-btn",{staticClass:"float-right",staticStyle:{"margin-top":"10px"},attrs:{color:"red",depressed:""},on:{click:e.deleteClass}},[e._v("\n              Yes, delete forever")])],1)],1)],1)],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports;k()(component,{VAlert:S.a,VBadge:w.a,VBtn:C.a,VCard:V.a,VCardActions:U.a,VCardText:U.c,VCol:$.a,VDivider:O.a,VExpansionPanel:T.a,VExpansionPanelContent:L.a,VExpansionPanelHeader:j.a,VExpansionPanels:I.a,VFileInput:E.a,VForm:M.a,VIcon:R.a,VList:F.a,VListItem:N.a,VListItemAction:A.a,VListItemAvatar:P.a,VListItemContent:D.a,VListItemSubtitle:D.b,VListItemTitle:D.c,VMenu:J.a,VRow:B.a,VSkeletonLoader:G.a,VSnackbar:H.a,VSpacer:z.a,VTab:Y.a,VTabItem:K.a,VTabs:Q.a,VTabsItems:W.a,VTextField:X.a,VTextarea:Z.a,VToolbar:ee.a,VToolbarTitle:te.a})}}]);